"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[111],{9111:function(e,n,r){r.r(n),r.d(n,{default:function(){return h}});var t=r(4165),o=r(5861),a=r(2791),c=r(153),s=r(9616),i=r(6030),u=r(4569),l=r.n(u),p=r(1713),d=r(5218),m=r(184),f=function(e){return new Promise((function(n){var r=document.createElement("script");r.src=e,r.onload=function(){n(!0)},r.onerror=function(){n(!1)},document.body.appendChild(r)}))},h=function(){var e,n=JSON.parse(sessionStorage.getItem("orderInfo")),r=(0,s.s0)(),u=(0,i.I0)(),h=(0,a.useRef)(null),v=(0,i.v9)((function(e){return e.cart})),y=v.shippingInfo,g=v.cartItems,x=(0,i.v9)((function(e){return e.user})).user,P=(0,i.v9)((function(e){return e.newOrder})).error;console.log("orderInfo.totalPrice:",n.totalPrice);var w=Math.round(n.totalPrice);console.log("amount:",w);var b={shippingInfo:y,orderItems:g,itemsPrice:n.subtotal,shippingPrice:n.shippingCharges,discount:n.discount,totalPrice:n.totalPrice},k=function(){var e=(0,o.Z)((0,t.Z)().mark((function e(n){var a,c,s,i,m,v;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),h.current.disabled=!0,e.prev=2,a={headers:{"Content-Type":"application/json"}},e.next=6,l().post("/api/v1/payment/process",{amount:w},a);case 6:return c=e.sent,s=c.data,console.log("data:",s),e.next=11,f("https://checkout.razorpay.com/v1/checkout.js");case 11:if(e.sent){e.next=14;break}throw new Error("Failed to load Razorpay script");case 14:i={key:"rzp_test_muoPW9MmgPxMRO",amount:100*w,currency:s.currency,name:"Kamal Medicos Pharma",description:"Payment for the order",image:"/logo192.png",order_id:s.id,handler:function(){var e=(0,o.Z)((0,t.Z)().mark((function e(n){return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{b.paymentInfo={id:n.razorpay_payment_id,status:"succeeded"},u((0,p.LV)(b)),r("/success")}catch(P){console.error(P),d.Am.error("There's some issue while processing payment ")}case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),prefill:{name:x.name,email:x.email,contact:y.phone}},new window.Razorpay(i).open(),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(2),h.current.disabled=!1,d.Am.error((null===(m=e.t0.response)||void 0===m||null===(v=m.data)||void 0===v?void 0:v.message)||e.t0.message);case 23:case"end":return e.stop()}}),e,null,[[2,19]])})));return function(n){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){console.log("useEffect called"),P&&(console.log("Error:",P),d.Am.error(P),u((0,p.b9)()))}),[u,P,d.Am]),console.log("Rendering Payment component"),(0,m.jsxs)(a.Fragment,{children:[(0,m.jsx)(c.Z,{activeStep:2}),(0,m.jsx)("div",{className:"paymentContainer",children:(0,m.jsx)("div",{className:"paymentBox",children:(0,m.jsx)("form",{className:"paymentForm",onSubmit:function(e){return k(e)},children:(0,m.jsx)("input",{type:"submit",value:"Pay - \u20b9".concat(n&&(null===(e=n.totalPrice)||void 0===e?void 0:e.toFixed(2))),ref:h,className:"paymentFormBtn"})})})})]})}}}]);
//# sourceMappingURL=111.8c40ea35.chunk.js.map