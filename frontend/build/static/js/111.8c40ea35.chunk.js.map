{"version":3,"file":"static/js/111.8c40ea35.chunk.js","mappings":"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","sources":["component/Cart/Payment.js"],"sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport axios from \"axios\";\nimport \"./payment.css\";\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\nimport { toast } from \"react-hot-toast\";\n\nconst loadScript = (src) => {\n  return new Promise((resolve) => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n    script.onload = () => {\n      resolve(true);\n    };\n    script.onerror = () => {\n      resolve(false);\n    };\n    document.body.appendChild(script);\n  });\n};\n\n\nconst Payment = () => {\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const payBtn = useRef(null);\n\n  const { shippingInfo, cartItems } = useSelector((state) => state.cart);\n  const { user } = useSelector((state) => state.user);\n  const { error } = useSelector((state) => state.newOrder);\n\n  console.log('orderInfo.totalPrice:', orderInfo.totalPrice);\n  const amount = Math.round(orderInfo.totalPrice);\n  console.log(\"amount:\", amount);\n\n  const order = {\n    shippingInfo,\n    orderItems: cartItems,\n    itemsPrice: orderInfo.subtotal,\n    shippingPrice: orderInfo.shippingCharges,\n    discount: orderInfo.discount,\n    totalPrice: orderInfo.totalPrice,\n  };\n\n  const submitHandler = async (e) => {\n    e.preventDefault();\n    payBtn.current.disabled = true;\n  \n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      };\n  \n      const { data } = await axios.post(\n        \"/api/v1/payment/process\",\n        { amount: amount },\n        config\n      );\n  \n      console.log(\"data:\", data);\n  \n      // Load the Razorpay script before initializing it\n      const scriptLoaded = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\n  \n      if (!scriptLoaded) {\n        throw new Error(\"Failed to load Razorpay script\");\n      }\n  \n      const options = {\n        key: \"rzp_test_muoPW9MmgPxMRO\",\n        amount: amount * 100,\n        currency: data.currency,\n        name: \"Kamal Medicos Pharma\",\n        description: \"Payment for the order\",\n        image: \"/logo192.png\",\n        order_id: data.id,\n        handler: async (response) => {\n          try {\n            order.paymentInfo = {\n              id: response.razorpay_payment_id,\n              status: \"succeeded\",\n            };\n            dispatch(createOrder(order));\n            navigate(\"/success\");\n          } catch (error) {\n            console.error(error);\n            toast.error(\"There's some issue while processing payment \");\n          }\n        },\n        prefill: {\n          name: user.name,\n          email: user.email,\n          contact: shippingInfo.phone,\n        },\n      };\n      const rzp = new window.Razorpay(options);\n      rzp.open();\n    } catch (error) {\n      payBtn.current.disabled = false;\n      toast.error(error.response?.data?.message || error.message);\n    }\n  };\n  \n\n  useEffect(() => {\n    console.log(\"useEffect called\");\n    if (error) {\n      console.log(\"Error:\", error);\n      toast.error(error);\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, toast]);\n\n  console.log(\"Rendering Payment component\");\n\n  return (\n    <Fragment>\n      <CheckoutSteps activeStep={2} />\n      <div className=\"paymentContainer\">\n        <div className=\"paymentBox\">\n          <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\n            <input\n              type=\"submit\"\n              value={`Pay - â‚¹${orderInfo && orderInfo.totalPrice?.toFixed(2)}`}\n              ref={payBtn}\n              className=\"paymentFormBtn\"\n            />\n          </form>\n        </div>\n      </div>\n    </Fragment>\n  );\n};\n\n\n\nexport default Payment;\n"],"names":["loadScript","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","_orderInfo$totalPrice","orderInfo","JSON","parse","sessionStorage","getItem","navigate","useNavigate","dispatch","useDispatch","payBtn","useRef","_useSelector","useSelector","state","cart","shippingInfo","cartItems","user","error","newOrder","console","log","totalPrice","amount","Math","round","order","orderItems","itemsPrice","subtotal","shippingPrice","shippingCharges","discount","submitHandler","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","e","config","_yield$axios$post","data","options","_error$response","_error$response$data","wrap","_context2","prev","next","preventDefault","current","disabled","headers","axios","sent","Error","key","currency","name","description","image","order_id","id","handler","_handler","_callee","response","_context","paymentInfo","razorpay_payment_id","status","createOrder","toast","stop","_x2","apply","arguments","prefill","email","contact","phone","window","Razorpay","open","t0","message","_x","useEffect","clearErrors","_jsxs","Fragment","children","_jsx","CheckoutSteps","activeStep","className","onSubmit","type","value","concat","toFixed","ref"],"sourceRoot":""}